(function(){var t,e,n,r,a,o,s,l,d,u,m,i,c,f,p,y,h,k,x;p={},r={},d={nodes:[],links:[],data:null,summary:{total:0},teams:{},players:{}},l=d3.format(",.0f"),s=function(t){return l(t)+"€"},t=function(t){return p.hasOwnProperty(t)||(d.nodes.push({name:t}),p[t]=d.nodes.length-1),p[t]},n=function(t,e){return d.teams.hasOwnProperty(t)||(d.teams[t]=0),d.teams[t]+=e},e=function(t,e){return d.players.hasOwnProperty(t)||(d.players[t]=0),d.players[t]+=e},h=function(t){return t.replace(/[FT]:/,"")},i=function(a){var o,s,l,u,m,i,c,f,p,y;for(d.data=a,f=0,p=a.length;p>f;f++)u=a[f],s=t("F:"+u["From Team Name"]),i=t("T:"+u["To Team Name"]),c=s+"|"+i,r.hasOwnProperty(c)||(r[c]=0),o=parseInt(u["Transfer Fee"]),r[c]+=o,d.summary.total+=o,n(s,o),n(i,-o),e(u["Player Name"],o);y=[];for(l in r)o=r[l],m=l.split("|"),y.push(d.links.push({source:d.nodes[m[0]],target:d.nodes[m[1]],value:o}));return y},x=function(t){return"<tr><td>"+t.Rank+"</td><td>"+t["Player Name"]+"</td><td>"+t["From Team Name"]+"</td><td>"+t["To Team Name"]+"</td><td>"+t["Transfer Season"]+"</td><td>"+s(t["Transfer Fee"])+"</td></tr>"},k=function(t){var e,n;return d3.select("#transfer-table tbody").html(t.join("")),e=d3.select("#transfer-modal"),e.style("display","block"),n=window.pageYOffset+200,e.style("top",n.toString()+"px")},a=function(){return d3.select("#transfer-modal").style("display","None")},c=function(){var t,e,n,r,a;d.links=d.links.sort(function(t,e){return e.value-t.value}),r=d3.select("#team-money-flow tbody"),n=[],a=d.links.slice(0,15);for(t in a)e=a[t],n.push("<tr><td>"+h(e.source.name)+"</td><td>"+h(e.target.name)+"</td><td>"+s(e.value)+"</td></tr>");return r.html(n.join(""))},f=function(t){var e,n,r,a,o,s,l,u;for("F"===t.name[0]?(e="From Team Name",a="from "):(e="To Team Name",a="to "),r=[],o=h(t.name),u=d.data,s=0,l=u.length;l>s;s++)n=u[s],n[e]===o&&r.push(x(n));return k(r),d3.select("#transfer-table-suffix").text(a+o)},m=function(t){var e,n,r,a,o,s,l;for(e=h(t.source.name),a=h(t.target.name),r=[],l=d.data,o=0,s=l.length;s>o;o++)n=l[o],n["From Team Name"]===e&&n["To Team Name"]===a&&r.push(x(n));return k(r),d3.select("#transfer-table-suffix").text(e+" to "+a)},o=function(){var t,e,n,r,a,o,l,u,i,c;return c=parseInt(d3.select("#vis").style("width").replace("px","")),400>c&&(c=400),t="\n\nClick for more details.",a={top:1,right:1,bottom:6,left:1},c=c-a.left-a.right,n=1200-a.top-a.bottom,e=d3.scale.category20(),i=d3.select("#vis").append("svg").attr("width",c+a.left+a.right).attr("height",n+a.top+a.bottom).append("g").attr("transform","translate("+a.left+","+a.top+")"),u=d3.sankey().nodeWidth(15).nodePadding(10).size([c,n]).nodes(d.nodes).links(d.links).layout(46),l=u.link(),r=i.append("g").selectAll(".link").data(d.links).enter().append("path").attr("class","link").attr("d",l).style("stroke-width",function(t){return Math.max(1,t.dy)}).sort(function(t,e){return e.dy-t.dy}).on("click",m),r.append("title").text(function(e){return h(e.source.name)+" → "+h(e.target.name)+"\n"+s(e.value)+t}),o=i.append("g").selectAll(".node").data(d.nodes).enter().append("g").attr("class","node").attr("transform",function(t){return"translate("+t.x+","+t.y+")"}),o.append("rect").attr("height",function(t){return t.dy}).attr("width",u.nodeWidth()).style("fill",function(t){return t.color=e(h(t.name))}).style("stroke",function(t){return d3.rgb(t.color).darker(2)}).on("click",f).append("title").text(function(e){return h(e.name)+"\n"+s(e.value)+t}),o.append("text").attr("x",-6).attr("y",function(t){return t.dy/2}).attr("dy",".35em").attr("text-anchor","end").attr("transform",null).text(function(t){return h(t.name)}).filter(function(t){return t.x<c/2}).attr("x",6+u.nodeWidth()).attr("text-anchor","start")},y=function(){var t,e,n;return d3.select("#summary-total").text(s(d.summary.total)),d.teams=d3.entries(d.teams).sort(function(t,e){return e.value-t.value}),e=d.teams[d.teams.length-1],n=h(d.nodes[e.key].name),d3.select("#summary-team-spent").text(n),d3.select("#summary-team-spent-total").text(s(e.value)),e=d.teams[0],n=h(d.nodes[e.key].name),d3.select("#summary-team-earned").text(n),d3.select("#summary-team-earned-total").text(s(e.value)),d.players=d3.entries(d.players).sort(function(t,e){return e.value-t.value}),t=d.players[0],d3.select("#summary-player").text(t.key),d3.select("#summary-player-total").text(s(t.value))},u=function(t,e){return i(e),o(),y(),c(),d3.select("#transfer-modal .close").on("click",a),document.body.onkeydown=function(t){return 27===t.keyCode&&a()}},("undefined"!=typeof exports&&null!==exports||this).init_sankey=u}).call(this);