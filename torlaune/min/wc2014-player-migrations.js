(function(){var t,e,n,r,a,l,i,o,s,u,c,d,f,p,h,y,g,m,v,k,x,b=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};e=null,a={nodes:[],links:[],config:null},d={},h=null,g={link:" â†’ "},v=null,k="\n\nClick to see the migrated players.",t=function(t){return d.hasOwnProperty(t)||(a.nodes.push({name:t}),d[t]=a.nodes.length-1),d[t]},f=function(t){return t.replace(/[FT]:/,"")},p=function(t){return f(t.name)+": "+t.value},s=function(t){return f(t.source.name)+g.link+f(t.target.name)+": "+t.value},i=function(t){return 0===t.indexOf("F:")},u=function(n){var r,l,i,o,s,u,c,d,f,p,h,y;for(r={},a.config=n,p=0,h=e.length;h>p;p++)c=e[p],i=t("F:"+c[n.from.key]),d=t("T:"+c[n.to.key]),s=i+"|"+d,r.hasOwnProperty(s)||(r[s]=0),l=null,l=n.aggregate.key?parseInt(c[n.aggregate.key],10):n.aggregate.value,r[s]+=l;y=[];for(o in r)f=r[o],u=o.split("|"),y.push(a.links.push({key:o,source:a.nodes[u[0]],target:a.nodes[u[1]],value:f}));return y},r=function(){var t,e,n,r,l,i,u;return u=parseInt(d3.select("#vis").style("width").replace("px","")),400>u&&(u=400),r={top:1,right:1,bottom:6,left:1},u=u-r.left-r.right,e=1080-r.top-r.bottom,t=d3.scale.category20(),v=d3.select("#vis").append("svg").attr("width",u+r.left+r.right).attr("height",e+r.top+r.bottom).append("g").attr("transform","translate("+r.left+","+r.top+")"),i=d3.sankey().nodeWidth(20).nodePadding(7).size([u,e]).nodes(a.nodes).links(a.links).layout(32),h=i.link(),n=v.append("g").selectAll(".link").data(a.links),n.enter().append("path").attr("class","link").attr("d",h).style("stroke-width",function(t){return Math.max(1,t.dy)}).sort(function(t,e){return e.dy-t.dy}).on("click",o).append("title").text(function(t){return s(t)+k}),l=v.append("g").selectAll(".node").data(a.nodes).enter().append("g").attr("class","node").attr("transform",function(t){return"translate("+t.x+","+t.y+")"}),l.append("rect").attr("height",function(t){return t.dy}).attr("width",i.nodeWidth()).style("fill",function(e){return e.color=t(f(e.name))}).style("stroke",function(t){return d3.rgb(t.color).darker(2)}).on("click",c).append("title").text(function(t){return p(t)+k}),l.append("text").attr("x",-6).attr("y",function(t){return t.dy/2}).attr("dy",".35em").attr("text-anchor","end").attr("transform",null).text(function(t){return f(t.name)}).filter(function(t){return t.x<u/2}).attr("x",6+i.nodeWidth()).attr("text-anchor","start")},x=function(t){return v.selectAll("path.link").style("opacity",function(e){return b.call(t,e)>=0?1:0})},n=function(){var t,e,n,r,l,o,u,c,d,f,h,y,g,m,v;for(e={},e.width=parseInt(d3.select("#sidebar").style("width").replace("px",""),10),l=a.links.sort(function(t,e){return e.value-t.value}),t=[],g=l.slice(0,10),u=0,f=g.length;f>u;u++)n=g[u],t.push({name:s(n),value:n.value});for(barh("#top-paths",t,e),r=a.nodes.filter(function(t){return i(t.name)}),l=r.sort(function(t,e){return e.value-t.value}),t=[],m=l.slice(0,10),c=0,h=m.length;h>c;c++)n=m[c],t.push({name:p(n),value:n.value});for(barh("#most-emigrations",t,e),o=a.nodes.filter(function(t){return!i(t.name)}),l=o.sort(function(t,e){return e.value-t.value}),t=[],v=l.slice(0,10),d=0,y=v.length;y>d;d++)n=v[d],t.push({name:p(n),value:n.value});return barh("#most-immigrations",t,e)},m=function(t){var e;return t=t.sort(function(t,e){return t.firstName>e.firstName?1:-1}),d3.select("#overlay").style("display","block"),e=d3.select("#detail-info"),e.selectAll("div.row").remove(),e.selectAll("div").data(t).enter().append("div").attr("class","row").html(function(t){return'<div class="col-md-2"><img class="img-thumbnail" src="'+t.image+'"/></div><div class="player-info col-md-10"><h5>'+t.firstName+" "+t.lastName+": "+t.birthCountry+g.link+t.nationality+"</h5></div>"})},y=function(){return d3.select("#rankings").style("display","none"),d3.select("#overlay").style("top",window.pageYOffset+"px")},c=function(t){var n,r,a,l,o,s;for(y(),i(t.name)?(x(t.sourceLinks),r="birthCountry"):(x(t.targetLinks),r="nationality"),a=[],n=f(t.name),o=0,s=e.length;s>o;o++)l=e[o],n===l[r]&&a.push(l);return m(a)},o=function(t){var n,r,a,l;for(y(),x([t]),n=[],a=0,l=e.length;l>a;a++)r=e[a],f(t.source.name)===r.birthCountry&&f(t.target.name)===r.nationality&&n.push(r);return m(n)},l=function(t,l){return e=l,u(t),r(),n(),d3.select("#close-overlay").on("click",function(){return d3.select("#overlay").style("display","none"),d3.select("#rankings").style("display","block"),x(a.links)})},("undefined"!=typeof exports&&null!==exports||this).init_sankey=l}).call(this);